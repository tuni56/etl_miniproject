ğŸš€ AutomatizaciÃ³n del ETL con AWS Lambda y S3 Event Triggers
Vamos a hacer que nuestro proceso ETL se ejecute automÃ¡ticamente cada vez que se suba un nuevo archivo al bucket etl-source-data.
Esto lo lograremos usando AWS Lambda + S3 Event Triggers.

ğŸ“ Plan de AcciÃ³n
âœ… Crear una funciÃ³n Lambda para ejecutar nuestro ETL.
âœ… Conectar Lambda a S3 con un Trigger de Evento (cuando se suba un archivo).
âœ… Probar subiendo un archivo y verificando que el ETL se ejecuta automÃ¡ticamente.

ğŸ”¹ Paso 1: Crear la FunciÃ³n Lambda
ğŸ“Œ Accede a la consola de AWS Lambda:
1ï¸âƒ£ Ve a AWS Console â†’ Lambda â†’ Create function
2ï¸âƒ£ Selecciona Author from Scratch
Function name: etl-process-lambda
Runtime: Python 3.9
Execution role: Create a new role with basic Lambda permissions
3ï¸âƒ£ Haz clic en Create function

ğŸ”¹ Paso 2: Asignar Permisos a Lambda
ğŸ“Œ Necesitamos darle a Lambda permisos para acceder a S3.
1ï¸âƒ£ Ve a IAM â†’ Roles
2ï¸âƒ£ Busca la rol de tu Lambda (serÃ¡ algo como etl-process-lambda-role-xxxx)
3ï¸âƒ£ Haz clic en Attach policies y agrega:
âœ… AmazonS3FullAccess (para leer y escribir en S3)
âœ… CloudWatchLogsFullAccess (para ver logs)
4ï¸âƒ£ Guarda los cambios

ğŸ”¹ Paso 3: Subir el CÃ³digo a Lambda
ğŸ“Œ Copiemos nuestro cÃ³digo de ETL en Lambda.

1ï¸âƒ£ Ve a Lambda â†’ etl-process-lambda
2ï¸âƒ£ En la pestaÃ±a Code, haz clic en Upload from â†’ .zip file
3ï¸âƒ£ Crea un ZIP con el cÃ³digo Python y las dependencias (Boto3, Pandas).

Si estÃ¡s en CloudShell, ejecuta:

mkdir lambda_etl && cd lambda_etl
nano lambda_function.py

ğŸ“Œ Crear el ZIP para Lambda
Ejecuta en CloudShell:
pip install pandas -t .
zip -r etl_lambda.zip .

ğŸ“Œ Subir el ZIP a Lambda
1ï¸âƒ£ Vuelve a Lambda
2ï¸âƒ£ Haz clic en Upload from â†’ .zip file
3ï¸âƒ£ Sube etl_lambda.zip

ğŸ”¹ Paso 4: Configurar el Trigger de S3
ğŸ“Œ Vamos a hacer que Lambda se ejecute automÃ¡ticamente cuando subimos un archivo a S3.

1ï¸âƒ£ Ve a S3 â†’ etl-source-data
2ï¸âƒ£ Haz clic en Properties â†’ Event notifications â†’ Create event notification

Name: trigger-lambda
Event type: All object create events
Destination: Lambda function
Function: etl-process-lambda
3ï¸âƒ£ Guarda los cambios

ğŸ”¹ Paso 5: Prueba la AutomatizaciÃ³n
ğŸ“Œ Sube un archivo nuevo a etl-source-data

Ejecuta en CloudShell:
aws s3 cp data.csv s3://etl-source-data/

ğŸ“Œ Revisar los logs en Lambda
1ï¸âƒ£ Ve a AWS Lambda â†’ etl-process-lambda
2ï¸âƒ£ En Monitor â†’ View logs in CloudWatch
3ï¸âƒ£ Si todo estÃ¡ bien, verÃ¡s los logs de la ejecuciÃ³n y el mensaje âœ… Datos cargados en s3://etl-processed-data/


